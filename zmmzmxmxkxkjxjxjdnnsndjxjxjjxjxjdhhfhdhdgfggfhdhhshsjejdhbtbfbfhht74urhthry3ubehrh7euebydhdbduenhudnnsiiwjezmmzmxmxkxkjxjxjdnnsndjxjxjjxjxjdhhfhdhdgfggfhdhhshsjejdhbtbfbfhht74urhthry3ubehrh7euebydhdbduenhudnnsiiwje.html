<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prediction Viewer HD</title>
  <style>
    body {
      background: #111;
      color: #fff;
      text-align: center;
      font-family: Arial, sans-serif;
      padding: 10px;
      display: flex;
      justify-content: start;
      align-items: center;
      flex-direction: column;
      height: 100vh;
      margin: 0;
      overflow-y: auto;
      position: relative;
    }
    #particles-js {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }
    .top-box, .image-box, .keyboard-row, .youtube-embed, #searchText, input, button, #popupBox {
      z-index: 1;
      position: relative;
    }
    .top-box {
      width: 100px;
      height: 100px;
      background-color: #222;
      border: 2px solid #00ffcc;
      border-radius: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      flex-direction: column;
    }
   .top-box img {
      animation: zoomInBox 2s ease-in-out forwards;
      transform-origin: center;
    }
    @keyframes zoomInBox {
      0% {
        transform: scale(0.3);
        opacity: 0;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
    #topImageContainer {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    .image-box {
      position: relative;
      width: 230px;
      height: 120px;
      background-color: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      border: 2px solid #00ffcc;
      border-radius: 8px;
      margin-bottom: 10px;
      overflow: hidden;
    }
    .image-box img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      animation: zoomInImage 3s ease-in-out forwards;
    }
    @keyframes zoomInImage {
      0% { transform: scale(0.2); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    input {
      width: 45px;
      font-size: 22px;
      margin: 2px;
      text-align: center;
      padding: 8px;
      background-color: #333;
      border: 2px solid #00ffcc;
      border-radius: 5px;
      color: white;
    }
    .keyboard-row {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin: 6px 0;
    }
    .keyboard-row button, button {
      width: 55px;
      height: 55px;
      font-size: 20px;
      border-radius: 10px;
      background-color: #222;
      border: 2px solid #00ffcc;
      color: white;
      cursor: pointer;
    }
    button.clear-btn {
      width: 120px;
      height: 60px;
      font-size: 22px;
      font-weight: bold;
      background-color: #333;
      margin-top: 10px;
    }
    #popupBox {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: transparent;
      color: transparent;
      padding: 0;
      border: none;
      box-shadow: none;
      font-size: 0;
    }
    #searchText {
      margin-top: 8px;
      font-size: 22px;
      font-weight: bold;
      color: #00ffcc;
    }
    .youtube-embed {
      margin-top: 12px;
      width: 250px;
      height: 390px;
      background-color: #222;
      border: 2px solid #FF0000;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .youtube-embed iframe {
      width: 100%;
      height: 100%;
    }
    #timerBox {
      position: fixed;
      top: 10px;
      right: 10px;
      color: #00ffcc;
      font-size: 20px;
      font-weight: bold;
      z-index: 999;
    }
  </style>
</head>
<body>
  <div id="particles-js"></div>
  <div id="timerBox"><span id="timer">00:30</span></div>
  <div id="topImageContainer">
    <div class="top-box" id="box1"></div>
    <div class="top-box" id="box2"></div>
    <div class="top-box" id="box3"></div>
  </div>
  <div class="image-box" id="imageBox"></div>
  <div id="searchText"></div>
  <div>
    <input type="number" id="n6" min="0" max="9" oninput="checkPattern()">
    <input type="number" id="n5" min="0" max="9" oninput="checkPattern()">
    <input type="number" id="n4" min="0" max="9" oninput="checkPattern()">
    <input type="number" id="n3" min="0" max="9" oninput="checkPattern()">
    <input type="number" id="n2" min="0" max="9" oninput="checkPattern()">
    <input type="number" id="n1" min="0" max="9" oninput="checkPattern()">
  </div>
  <button class="clear-btn" onclick="window.location.href='kkk.html'">STEP</button>
  <div id="popupBox"><p id="popupText"></p></div>
  <div class="youtube-embed">
    <iframe src="https://hgzy.in/#/register?invitationCode=86571936984" frameborder="0" allowfullscreen></iframe>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/particles.js"></script>
  <script>
    particlesJS('particles-js', {
      particles: {
        number: { value: 130, density: { enable: true, value_area: 800 } },
        color: {
          value: [
            "#ff0000", "#00ff00", "#0000ff", "#ffff00",
            "#00ffff", "#ff00ff", "#ffffff", "#ffaa00",
            "#ff66cc", "#66ffcc", "#3399ff", "#ccff33"
          ]
        },
        shape: { type: "circle" },
        opacity: { value: 0.6, random: true, anim: { enable: true, speed: 0.8, opacity_min: 0.2, sync: false } },
        size: { value: 3.5, random: true, anim: { enable: true, speed: 4, size_min: 0.5, sync: false } },
        line_linked: { enable: true, distance: 100, color: "#ffffff", opacity: 0.3, width: 1 },
        move: {
          enable: true, speed: 2, direction: "none", random: false,
          straight: false, out_mode: "out", bounce: false,
          attract: { enable: true, rotateX: 600, rotateY: 1200 }
        }
      },
      interactivity: {
        detect_on: "canvas",
        events: {
          onhover: { enable: true, mode: "grab" },
          onclick: { enable: true, mode: "push" },
          resize: true
        },
        modes: {
          grab: { distance: 200, line_linked: { opacity: 0.6 } },
          push: { particles_nb: 4 }
        }
      },
      retina_detect: true
    });

    let datasetBS = [], datasetRG = [];
    let datasetBS2 = [], datasetRG2 = [];

    fetch('https://raw.githubusercontent.com/Nyeem122-8/Jdjdjjfjfj/refs/heads/main/dataset.json')
      .then(res => res.json()).then(data => datasetBS = data);
    fetch('https://raw.githubusercontent.com/Nyeem122-8/Jdjdjjfjfj/refs/heads/main/dataset1.json')
      .then(res => res.json()).then(data => datasetRG = data);
    fetch('https://raw.githubusercontent.com/Nyeem122-8/Jdjdjjfjfj/refs/heads/main/data1.json')
      .then(res => res.json()).then(data => datasetBS2 = data);
    fetch('https://raw.githubusercontent.com/Nyeem122-8/Jdjdjjfjfj/refs/heads/main/data.json')
      .then(res => res.json()).then(data => datasetRG2 = data);

    function numToBS(num) {
      return num >= 5 ? "B" : "S";
    }

    function numToRG(num) {
      return [1, 3, 5, 7, 9].includes(num) ? "G" : "R";
    }

    function findMatch(dataset, pattern) {
      for (let i = dataset.length - pattern.length; i >= 1; i--) {
        let slice = dataset.slice(i - pattern.length, i);
        if (JSON.stringify(slice) === JSON.stringify(pattern)) {
          return dataset[i];
        }
      }
      return null;
    }

    function checkPattern() {
      let inputs = [];
      for (let i = 6; i >= 1; i--) {
        let val = document.getElementById("n" + i).value;
        if (val !== "") {
          inputs.push(parseInt(val));
        }
      }
      if (inputs.length < 2) {
        document.getElementById("imageBox").innerHTML = "<p style='color:#ff4444;'>কমপক্ষে ২টি সংখ্যা দিন।</p>";
        return;
      }

      let bsPattern = inputs.map(numToBS).reverse();
      let rgPattern = inputs.map(numToRG).reverse();
      const now = Date.now();
      const cycleTime = (now / 1000) % 300;

      let bsSet = cycleTime < 150 ? datasetBS : datasetBS2;
      let rgSet = cycleTime < 150 ? datasetRG : datasetRG2;

      let matchBS = findMatch(bsSet, bsPattern);
      let matchRG = findMatch(rgSet, rgPattern);

      let imageBox = document.getElementById("imageBox");
      imageBox.innerHTML = "";

      if (matchBS && matchRG) {
        let combo = matchBS + matchRG;
        let imageName = combo + ".png";
        let img = document.createElement("img");
        img.src = imageName;
        img.alt = combo;
        imageBox.appendChild(img);
        showPopup(combo);
        updateTopBoxes(combo);
      } else {
        imageBox.innerHTML = "<p style='color:#ff4444;'></p>";
      }
    }

    function updateTopBoxes(combo) {
      const topImages = {
        SR: ['num0.png', 'num2.png', 'num4.png'],
        SG: ['num1.png', 'num3.png'],
        BG: ['num5.png', 'num7.png', 'num9.png'],
        BR: ['num6.png', 'num8.png']
      };
      const box1 = document.getElementById("box1");
      const box2 = document.getElementById("box2");
      const box3 = document.getElementById("box3");
      [box1, box2, box3].forEach(box => box.innerHTML = "");
      let images = [];
      for (let key in topImages) {
        if (combo.includes(key)) {
          images = topImages[key];
          break;
        }
      }
      const boxes = [box1, box2, box3];
      images.forEach((imgSrc, idx) => {
        const img = document.createElement("img");
        img.src = imgSrc;
        boxes[idx].appendChild(img);
      });
    }

    function clearInputs() {
      for (let i = 1; i <= 6; i++) {
        document.getElementById("n" + i).value = "";
      }
      document.getElementById("imageBox").innerHTML = "";
      ['box1', 'box2', 'box3'].forEach(id => document.getElementById(id).innerHTML = "");
      document.getElementById("searchText").innerText = "";
      fetchLatestNumbers();
    }

    function showPopup(text) {
      let popupBox = document.getElementById('popupBox');
      let popupText = document.getElementById('popupText');
      popupText.innerHTML = text;
      popupBox.style.display = 'block';
      setTimeout(() => popupBox.style.display = 'none', 1000);
    }

    function fetchLatestNumbers() {
      const requestData = {
        pageSize: 10,
        pageNo: 1,
        typeId: 30,
        language: 0,
        random: "62d02162c2234c64b57aa4188c5810b2",
        signature: "9BF7A245709AA054E231D75C404C6527",
        timestamp: Math.floor(Date.now() / 1000)
      };
      fetch('https://crbbb.com/api/webapi/GetNoaverageEmerdList', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json;charset=UTF-8',
          'Accept': 'application/json, text/plain, */*'
        },
        body: JSON.stringify(requestData)
      })
      .then(response => response.json())
      .then(data => {
        const numbers = data.data.list.slice(0, 6).map(item => item.number % 10);
        for (let i = 6; i >= 1; i--) {
          document.getElementById("n" + i).value = numbers[6 - i];
        }
        checkPattern();
      })
      .catch(error => console.error('Error fetching API numbers:', error));
    }

    setInterval(() => {
      [datasetBS, datasetBS2] = [datasetBS2, datasetBS];
      [datasetRG, datasetRG2] = [datasetRG2, datasetRG];
      console.log("Datasets swapped automatically!");
    }, 210000);

    function startRefreshTimer() {
      function updateTimer() {
        const now = new Date();
        const remaining = 30 - (now.getSeconds() % 30);
        document.getElementById("timer").innerText = `00:${String(remaining).padStart(2, '0')}`;
        if (remaining === 30) {
          clearInputs();
          fetchLatestNumbers();
        }
        setTimeout(updateTimer, 1000);
      }
      updateTimer();
    }

    document.addEventListener("DOMContentLoaded", () => {
      fetchLatestNumbers();
      startRefreshTimer();
    });
  </script>
</body>
</html>
